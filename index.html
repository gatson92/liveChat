<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í’€ê¸°ëŠ¥ ì±„íŒ…</title>
<style>
/* â”€â”€â”€â”€â”€ ê³µí†µ reset & ë³€ìˆ˜ â”€â”€â”€â”€â”€ */
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#f0f2f5;--bg-dark:#1f2937;--card:#fff;--card-dark:#374151;
       --main:#4f46e5;--txt:#111;--txt-dark:#f3f4f6}
body{font-family:Segoe UI,Arial,sans-serif;background:var(--bg);height:100vh;
     display:flex;justify-content:center;align-items:center;color:var(--txt);transition:.3s}
body.dark{background:var(--bg-dark);color:var(--txt-dark)}
/* â”€â”€â”€â”€â”€ ì¹´ë“œ ì»¨í…Œì´ë„ˆ â”€â”€â”€â”€â”€ */
#app{width:420px;max-width:95vw;height:620px;background:var(--card);
     border-radius:12px;box-shadow:0 12px 20px rgba(0,0,0,.12);
     display:flex;flex-direction:column;overflow:hidden;transition:.3s}
body.dark #app{background:var(--card-dark)}
/* í—¤ë” */
header{background:var(--main);color:#fff;padding:1rem 1.4rem;font-weight:700;
       display:flex;justify-content:space-between;align-items:center}
#darkToggle{background:none;border:none;color:#fff;font-size:1.3rem;cursor:pointer}
/* ë°© ì„ íƒ UI */
#roomSel{padding:4px;border-radius:6px;border:none;font-weight:600}
/* ë©”ì‹œì§€ ì˜ì—­ */
#msgs{flex:1;overflow-y:auto;padding:1rem;background:var(--bg);transition:.3s}
body.dark #msgs{background:#111827}
/* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
.msg{max-width:80%;margin-bottom:12px;padding:8px 12px;border-radius:12px;
     background:#e4e7f1;color:#1f2937;word-break:break-word;box-shadow:0 1px 2px rgb(0 0 0 / .1)}
.msg.me{background:#4f46e5;color:#fff;margin-left:auto;box-shadow:0 4px 8px rgba(79,70,229,.4)}
.msg.sys{background:transparent;color:#9ca3af;text-align:center;box-shadow:none;margin:16px auto}
.msg .name{font-weight:700;margin-bottom:4px}
/* ì…ë ¥ ì˜ì—­ */
#form{display:flex;border-top:1px solid #ddd;padding:.7rem;background:var(--card)}
#text{flex:1;padding:.6rem 1rem;border-radius:20px;border:1px solid #ccc;resize:none;height:46px}
#send,#fileBtn{background:var(--main);border:none;color:#fff;border-radius:20px;
               padding:0 18px;margin-left:8px;cursor:pointer;font-weight:700}
#send:disabled{background:#a5b4fc;cursor:not-allowed}
/* ì´ëª¨ì§€ íŒ¨ë„ */
#emojiBox{position:absolute;bottom:70px;right:16px;display:none;
          background:var(--card);border-radius:12px;padding:10px;box-shadow:0 0 10px rgba(0,0,0,.15)}
#emojiBox span{font-size:1.4rem;margin:4px;cursor:pointer}
body.dark #emojiBox{background:#374151}
</style></head><body>

<!-- â”€â”€â”€â”€â”€ ì±„íŒ… ì¹´ë“œ(ì•±) â”€â”€â”€â”€â”€ -->
<div id="app">
  <!-- í—¤ë”: ë°© ì„ íƒ Â· ë‹¤í¬ëª¨ë“œ ë²„íŠ¼ -->
  <header>
    <select id="roomSel">
      <option value="lobby">lobby</option>
      <option value="music">music</option>
      <option value="game">game</option>
    </select>
    <button id="darkToggle" title="ë‹¤í¬ëª¨ë“œ">ğŸŒ™</button>
  </header>

  <!-- ë©”ì‹œì§€ ì¶œë ¥ -->
  <div id="msgs" aria-live="polite"></div>

  <!-- ì…ë ¥ í¼ -->
  <form id="form" autocomplete="off">
    <textarea id="text" placeholder="ë©”ì‹œì§€... (Enter=ì „ì†¡, Shift+Enter ì¤„ë°”ê¿ˆ)" maxlength="300"></textarea>
    <input type="file" id="file" accept="image/*" hidden>
    <button type="button" id="fileBtn">ğŸ“</button>
    <button type="submit" id="send" disabled>ì „ì†¡</button>
  </form>
</div>

<!-- ì´ëª¨ì§€ ë‹¨ì¶• íŒ¨ë„ -->
<div id="emojiBox">ğŸ™‚ ğŸ˜‚ ğŸ˜ ğŸ¤” ğŸ‘ ğŸ™Œ ğŸ‰ ğŸ’¯ ğŸš€</div>

<script>
/* â”€â”€â”€â”€â”€ ì „ì—­ DOM ë° ìƒíƒœ â”€â”€â”€â”€â”€ */
const $ = id=>document.getElementById(id);
const msgs = $('msgs'), txt=$('text'), send=$('send'),
      roomSel=$('roomSel'), darkBtn=$('darkToggle'),
      emojiBox=$('emojiBox'), fileBtn=$('fileBtn'), fileInp=$('file');

let nick  = prompt('ë‹‰ë„¤ì„?')?.trim()||'ì†ë‹˜';
$('text').placeholder = nick+' > ë©”ì‹œì§€...';
let room  = roomSel.value;

/* â”€â”€â”€â”€â”€ ë‹¤í¬ëª¨ë“œ í† ê¸€ ìƒíƒœ ê¸°ì–µ(localStorage) â”€â”€â”€â”€â”€ */
if(localStorage.dark==='1'){document.body.classList.add('dark');darkBtn.textContent='â˜€ï¸';}
darkBtn.onclick=()=>{document.body.classList.toggle('dark');
  darkBtn.textContent=document.body.classList.contains('dark')?'â˜€ï¸':'ğŸŒ™';
  localStorage.dark=document.body.classList.contains('dark')?'1':'0';};

/* â”€â”€â”€â”€â”€ ì›¹ì†Œì¼“ ì—°ê²° â”€â”€â”€â”€â”€ */
const ws = new WebSocket('ws://localhost:3000');
ws.onopen = ()=> joinRoom();
ws.onmessage = e=>{
  const m=JSON.parse(e.data);
  if(m.room && m.room!==room) return;          // ë‹¤ë¥¸ ë°© ë©”ì‹œì§€ ë¬´ì‹œ
  if(m.type==='sys')  return addMsg('sys',m.text);
  if(m.type==='text') return addMsg(m.from===nick?'me':'other',m.text,m.from);
  if(m.type==='file') return addFile(m.from===nick?'me':'other',m);
};
function joinRoom(){
  ws.send(JSON.stringify({type:'join',room,nick}));
  msgs.innerHTML=''; addMsg('sys',`[${room}] ì…ì¥`);
}

/* â”€â”€â”€â”€â”€ ë©”ì‹œì§€ ë Œë”ë§ â”€â”€â”€â”€â”€ */
function addMsg(kind,text,name=''){
  const d=document.createElement('div'); d.className='msg '+kind;
  if(kind!=='sys'){const nm=document.createElement('div');nm.className='name';nm.textContent=name;d.appendChild(nm);}
  d.appendChild(document.createTextNode(text));
  msgs.appendChild(d); msgs.scrollTop=msgs.scrollHeight;
}
function addFile(kind,{from,name,data}){
  const d=document.createElement('div'); d.className='msg '+kind;
  const nm=document.createElement('div');nm.className='name';nm.textContent=from;d.appendChild(nm);
  const img=new Image(); img.src=data; img.alt=name; img.style.maxWidth='160px'; img.style.borderRadius='8px';
  d.appendChild(img); msgs.appendChild(d); msgs.scrollTop=msgs.scrollHeight;
}

/* â”€â”€â”€â”€â”€ ì „ì†¡ / ì…ë ¥ ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€ */
txt.oninput = ()=> send.disabled=txt.value.trim()==='';
txt.onkeydown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); formSubmit();}}
$('form').onsubmit=e=>{e.preventDefault(); formSubmit();};
function formSubmit(){
  const t=txt.value.trim(); if(!t) return;
  ws.send(JSON.stringify({type:'text',text:t}));
  txt.value=''; send.disabled=true;
}
/* â”€â”€â”€â”€â”€ ë°© ë³€ê²½ â”€â”€â”€â”€â”€ */
roomSel.onchange=()=>{room=roomSel.value;joinRoom();};

/* â”€â”€â”€â”€â”€ ì´ëª¨ì§€ íŒ¨ë„ â”€â”€â”€â”€â”€ */
txt.onfocus=()=>emojiBox.style.display='none';
fileBtn.onclick=()=>fileInp.click();
document.body.addEventListener('contextmenu',e=>{e.preventDefault(); emojiBox.style.display='block';
  emojiBox.style.left=e.pageX-50+'px'; emojiBox.style.top=e.pageY-emojiBox.offsetHeight+'px';});
emojiBox.onclick=e=>{if(e.target.tagName==='SPAN'){txt.value+=e.target.textContent; txt.dispatchEvent(new Event('input'));}}

/* â”€â”€â”€â”€â”€ íŒŒì¼ ì „ì†¡ â”€â”€â”€â”€â”€ */
fileInp.onchange=()=>{
  const f=fileInp.files[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=()=>{ws.send(JSON.stringify({type:'file',name:f.name,data:reader.result}));}
  reader.readAsDataURL(f);
};
</script>
</body></html>
